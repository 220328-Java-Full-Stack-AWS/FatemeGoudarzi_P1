<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to ERS</title>
    <link rel="stylesheet" type="text/css" href="./style.css">
</head>

<body>
    <p id="pageContent"></p>
    <div class="grid-container">
        <div class="header" style="background-color: var(--clr-grey-2);color: var(--clr-grey-10)">
            <h3 id="header-title"></h3>
        </div>
        <div class="main">
            <h4>New Reimbursement</h4>
            <div class="content-box reim-form">
                <div class="flex-column">
                    <div class="flex-row">
                        <label>Reimbursement Type: </label>
                        <select class="reimb-type" id="reimb-type" name="type" >
                            <option value="1">Lodging</option>
                            <option value="2">Travel</option>
                            <option value="3">Food</option>
                            <option value="4">Other</option>
                        </select>
                    </div>
                    <div class="flex-row">
                        <label>Amount: </label>
                        <input type="number" id="amount" placeholder="amount" name="">
                    </div>                       
                    <div  class="flex-row">
                        <label>Description: </label>
                        <input type="textarea" id="description" placeholder="description" name="">
                    </div>
                </div>
            <button class="btn submit" type="button" id="submit-reimb-btn" name="">submit</button>
            </div>

        </div>
        <div class="menu">
            <div>
                <h3>Reports</h3>
                <ul >
                    <li>
                        <button class="btn" name="">all Reimbursements</button>
                    </li>
                    <li>
                        <button class="btn">resolved Reimbursements</button>
                    </li>
                    <li>
                        <button class="btn">pending Reimbursements </button>
                    </li>
                    <li>
                        <button class="btn">new Reimbursements </button>
                    </li>
                </ul>
            </div>
        </div>

        <div class="right">
            <div>
                <ul class="links">
                    <li>
                        <a onclick="clickHandler(this)" name="register">Register</a>
                    </li>
                    <li>
                        <a onclick="clickHandler(this)" name="settings">Settings</a>
                    </li>
                    <li>
                        <a onclick="clickHandler(this)" name="logout">Logout </a>
                    </li>
                </ul>
            </div>
        </div>

    </div>
    <script type="text/javascript" src="js/home.js"></script>

    <!-- This imports a script file, in this case it imports the exported scripts from that file -->
    <script src="./scripts/userConnection.js"></script>
    <script>
          const reimSubmitBtn = document.getElementById('submit-reimb-btn');

          reimSubmitBtn.addEventListener('click',reimbCreate);
        let authorizedUser = localStorage.getItem("authToken");
        console.log("authorizedUser: ", authorizedUser);

        /*
        This is a self-invoking function. To build one, wrap the function declaration in ()
        then add another pair of () at the end to act as the parameter list. Effectively
        as soon as the function is defined it is called.
        */
        (async function displayUser() {
            let response = await getUser(authorizedUser);
            let json = await response.json();
            console.log("Response: ", response);
            console.log("Response JSON: ", json);
            let header ="Welcome, " + json.firstName +" "+ json.lastName;
            document.getElementById("header-title").innerText = header;
        })(); 

        function clickHandler(element){
            let elm_name = element.name;
            let roleId = localStorage.getItem("roleId").toLowerCase();
            if(roleId == "admin" && elm_name=="register"){
                window.location.href="./register.html";
            }
            else if(roleId != "admin" && elm_name=="register")
            {
                alert("You are not authorized to register an account!")
            }
            else if(elm_name=="settings"){
                window.location.href="./settings.html";
            }
        }

        function reimbCreate(){
            let reimbType=document.getElementById("reimb-type").value;
            let amount=document.getElementById("amount").value;
            let description=document.getElementById("description").value;
            console.log(reimbType, amount,description);
            
            const timeStamp = Date.now();
            const reimbData=
            {       
                "creationDate": timeStamp,
                "reimbursementTypeId":reimbType,
                "reimbursementDescription":description,
                "reimbursementAmount":amount,
                "reimbursementCreator":localStorage.getItem("roleId")
           }
           console.log(reimbData)

        }
        


    </script>
</body>

</html>